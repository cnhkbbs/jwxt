"use strict";const e=require("../../common/vendor.js"),t={data:()=>({host_url:"",username:"",token:"",role:"1",name:"",college:"",major:"",phone:"",is_teacher:!1}),onLoad(){this.host_url=getApp().globalData.host_url,this.prepareData()},methods:{async prepareData(){await this.loadUserData(),this.checkRole(),this.getUserInfo()},loadUserData(){const t=[];return new Promise(((a,o)=>{let r=this.getStorageData("token","token",t),s=this.getStorageData("username","username",t),i=this.getStorageData("role","role",t);Promise.all([r,s,i]).then((()=>{t.length>0?e.index.navigateTo({url:"/pages/login/login"}):a()})).catch((e=>{console.error("Promise.all failed with error:",e),o(e)}))}))},getStorageData(t,a,o){return new Promise(((r,s)=>{e.index.getStorage({key:t,success:e=>{this[a]=e.data,r()},fail:e=>{o.push(`${t} data retrieval failed.`),r()}})}))},checkRole(){"1"!=this.role&&(this.is_teacher=!0)},getUserInfo(){e.index.showLoading({title:"加载中"}),e.index.request({url:this.host_url+"members/user_info",method:"POST",data:{username:this.username,token:this.token,role:this.role},success:t=>{e.index.hideLoading(),200!=t.statusCode&&""!=this.token?(e.index.showToast({title:"登录信息过期",icon:"error"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1e3)):this.is_teacher?(this.name=t.data.name,this.phone=t.data.phone):(this.name=t.data.name,this.phone=t.data.phone,this.major=t.data.major,this.college=t.data.college)},fail:t=>{e.index.hideLoading(),e.index.showToast({title:"网络错误",icon:"error"})}})}}};const a=e._export_sfc(t,[["render",function(t,a,o,r,s,i){return{a:e.t(s.name),b:e.t(s.phone),c:e.t(s.college),d:e.t(s.major),e:!s.is_teacher,f:e.t(s.name),g:e.t(s.phone),h:s.is_teacher}}]]);wx.createPage(a);
