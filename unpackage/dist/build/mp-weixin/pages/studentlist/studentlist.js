"use strict";const e=require("../../common/vendor.js"),t={onLoad(e){this.host_url=getApp().globalData.host_url,this.refer=e.refer,this.prepareData()},data:()=>({host_url:"",student_list:[],token:"",username:"",refer:""}),methods:{goNext(e){"grades"===this.refer?this.goToGradesPage(e):"analysis"===this.refer&&this.goToGradesAnalysisPage(e)},goToGradesPage(t){e.index.navigateTo({url:"/pages/grades/grades?studentid="+t})},goToGradesAnalysisPage(t){e.index.navigateTo({url:"/pages/gradesanalysis/gradesanalysis?studentid="+t})},async prepareData(){await this.loadUserData(),this.getStudentList()},loadUserData(){const t=[];return new Promise(((a,s)=>{let i=this.getStorageData("token","token",t),o=this.getStorageData("username","username",t);Promise.all([i,o]).then((()=>{t.length>0?e.index.navigateTo({url:"/pages/login/login"}):a()})).catch((e=>{console.error("Promise.all failed with error:",e),s(e)}))}))},getStorageData(t,a,s){return new Promise(((i,o)=>{e.index.getStorage({key:t,success:e=>{this[a]=e.data,i()},fail:e=>{s.push(`${t} data retrieval failed.`),i()}})}))},getStudentList(){e.index.showLoading({title:"加载中"}),e.index.request({url:this.host_url+"members/get_students",method:"POST",data:{token:this.token,username:this.username},header:{"content-type":"application/json"},success:t=>{if(e.index.hideLoading(),200!=t.statusCode&&""!=this.token)e.index.showToast({title:"登录信息过期",icon:"error"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1e3);else{const e=t.data;this.$set(this,"student_list",e)}},fail:t=>{e.index.hideLoading(),console.log(t.data),e.index.navigateTo({url:"/pages/login/login"})}})}}};if(!Array){e.resolveComponent("uni-icons")()}Math;const a=e._export_sfc(t,[["render",function(t,a,s,i,o,r){return{a:e.f(o.student_list,((t,a,s)=>({a:e.t(a),b:e.t(t),c:"f45480ce-0-"+s,d:a,e:e.o((e=>r.goNext(a)),a)}))),b:e.p({type:"right",size:"26"})}}]]);wx.createPage(a);
