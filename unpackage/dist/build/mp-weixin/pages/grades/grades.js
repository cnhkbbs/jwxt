"use strict";const e=require("../../common/vendor.js"),t={onLoad(e){this.host_url=getApp().globalData.host_url,this.studentid=e.studentid,this.prepareData()},data:()=>({host_url:"",token:"",username:"",role:"",grades_lists:{},studentid:""}),methods:{async prepareData(){e.index.showLoading({title:"加载中"}),await this.loadUserData(),this.getGrades(),e.index.hideLoading()},getGrades(){e.index.showLoading({title:"加载中"}),e.index.request({url:this.host_url+"grades/get_grades",method:"POST",data:{token:this.token,username:this.username,role:this.role,student_id:this.studentid},header:{"content-type":"application/json"},success:t=>{if(e.index.hideLoading(),200!=t.statusCode&&""!=this.token)e.index.showToast({title:"登录信息过期",icon:"error"}),setTimeout((()=>{e.index.navigateTo({url:"/pages/login/login"})}),1e3);else{let e=t.data;e=e.grades;const s=e;this.$set(this,"grades_lists",s)}},fail:t=>{e.index.hideLoading(),e.index.showToast({title:"网络错误",icon:"error"})}})},loadUserData(){const t=[];return new Promise(((s,n)=>{let a=this.getStorageData("token","token",t),i=this.getStorageData("username","username",t),o=this.getStorageData("role","role",t);Promise.all([a,i,o]).then((()=>{t.length>0?e.index.navigateTo({url:"/pages/login/login"}):s()})).catch((e=>{console.error("Promise.all failed with error:",e),n(e)}))}))},getStorageData(t,s,n){return new Promise(((a,i)=>{e.index.getStorage({key:t,success:e=>{this[s]=e.data,a()},fail:e=>{n.push(`${t} data retrieval failed.`),a()}})}))}}};if(!Array){(e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table"))()}Math||((()=>"../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../uni_modules/uni-table/components/uni-table/uni-table.js"))();const s=e._export_sfc(t,[["render",function(t,s,n,a,i,o){return{a:e.f(i.grades_lists,((t,s,n)=>({a:e.f(t,((t,s,a)=>({a:e.t(t),b:s,c:"2f248a36-8-"+n+"-"+a+",2f248a36-7-"+n}))),b:s,c:"2f248a36-7-"+n+",2f248a36-0"}))),b:e.p({stripe:!0,emptyText:"暂无更多数据"})}}]]);wx.createPage(s);
